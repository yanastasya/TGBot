# dev-bridge-backend-tg-bot
Бот - посредник между пользователями и администраторами.

### Для чего нужен этот бот?
Для того, чтобы пользователь (посетитель сайта) мог задать любой интересующий его вопрос команде проекта, а администраторы могли увидеть это вопрос в закрытом чате, обсудить его и отправить ответ. Пользователь получает ответ от имени бота.
### Что необходимо для работы бота:
Вопросы от пользователей, которые они пишут в чат с ботом, будут пересылаться в чаты, id которых вносятся в файл .env. Бот должен быть участником этих групп и иметь там права администратора. 

### Сценарий поведения бота:

- Пользователь открывает чат с ботом, нажимает /start : бот присылает сообщение 'Добрый день! Выберите, пожалуйста, тему обращения!' и 4 кнопки для выбора темы обращения: Сотрудничество, Баги, Платформа, Другое.

>Если после команды /start пользователь отвечает боту иным способом, кроме >как нажатием кнопки с темой обращения, бот пришлет ему сообщеие: 'Пожалуйста, >выберите тему обращения, нажав одну из кнопок. Если вы передумали задавать >вопрос - отправьте команду /cancel.'        
- Пользователь выбирает тему:
        Бот отвечает: 'Спасибо! А теперь введите ваш вопрос.'
 - Пользователь пишет вопрос. Он может быть как текстовый, так и любой другой.:
- Бот пересылает сообщение в группу администраторов (свободную от работы с обращеними в данный момент), а пользователь получает сообщение о том, что его вопрос принят.
>Для работы бота должно быть создано несколько чатов для работы с обращениями пользователей. Бот должен быть участником этих чатов и иметь права администратора в них. Предполагается, что пока в чате идёт работа с обращением >одного пользователя, то туда поступают только сообщения от этого пользователя. >Когда вопрос исчерпан, администратор нажимает кнопку "закрыть обращение", и чат >становится "свободным" - т.е. готов принять следующее обращение. 
>Также создаётся один дополнительный чат, куда будут пересылаться обращения в случае, если основные чаты заняты. Для дополнительного чата нет ограничений на колличество обращений, рассматриваемых в нём одновременно. 

- Когда в чат администраторов приходит первое сообщение от пользователя, то бот выбирает свободный чат, постит туда информацию о поступившем обращении. Вместе с информацией прикрепляется копка "закрыть обращение"
- все остальные сообщения пользователя в чат с ботом, кроме первого, приходят в чат администраторов в виде пересланного сообщения    

- Получив обращение, администраторы могут обсудить его между собой, отправляя сообщения в чат, можно использовать reply на сообщения друг друга. Эта переписка остаётся внутри чата. Для отправки ответа пользователю необходимо делать Reply на сообщения бота (пересланные собщения от пользователя).
-когда вопрос исчерпан, администратор нажимает "закрыть обращение". После чего бот уточняет: 'Вы уверены, что хотите закрыть обращение?' (к сообщению прикрепляются 2 кнопки да/нет). При ответе нет можно продолжить работу с обращением в данном чате. 
- При ответе ДА:
        бот возвращает название чата в исходное;
        сохраняет в базу данных тему обращения, дату/время его открытия и закрытия;
        просит администратора очистить чат,
        отправляет пользователю сообщение: 'Ваше обращение было закрыто. Вы выяснили всё,что хотели?'. Вопрос риторический, т.к. не зависимо от ответа пользователя (кнопки да/нет), ему будет предложено воспользоваться командой /start при желании задать новый вопрос.

### Проблемы в работе бота, которые я не могу решить:
- Для работы бота ему нужно оперировать данными: сохранять и извелать из словарей user_dict и admins_chat_ctatus. Я понимаю, что вариант с использованием внутреннего хранилища очень плох, нужно подключать внешнее хранилище типа Redis для этих целей. Так же Redis здесь необходим для работы fsm. В данный момент использовано MemoryStorage для работы fsm. С подключением Redis не могу разобраться.
- в хэндере handlers.admin_handlers.process_confirm_closing (обрабатывает процесс закрытия обращения) нужно чтобы бот сам очищал историю чата после закрытия обращения. не нашла способа,как это сделать. Знаю метод, который по id сообщения удаляет его. но как собрать все id сообщений в чате?...



